\ProvidesPackage{sleek-title}[2022/09/13 v1.2.0 Sleek Title]

%%%%%%%%%%%%
% Settings %
%%%%%%%%%%%%

\RequirePackage{geometry}
\RequirePackage{graphicx}
\RequirePackage[framemethod=TikZ]{mdframed}
\RequirePackage[nomessages]{fp}

%%%%%%%%%%%
% Heights %
%%%%%%%%%%%

\newlength\topheight
\newlength\logoheight
\newlength\titleskipabove
\newlength\titleskipbelow

\newcommand*{\calculateheights}{
    \countlines{\bfseries\huge\@title}
    \FPeval{\topratio}{0.2 - 0.01 * (\numlines - 1)}
    \FPeval{\skipratio}{\topratio - 0.15}
    \setlength{\logoheight}{0.15\textheight}
    \setlength{\topheight}{\topratio\textheight}
    \setlength{\titleskipabove}{\skipratio\textheight}
    \setlength{\titleskipbelow}{3ex}
}

\DeclareOption{classic}{
    \renewcommand*{\calculateheights}{
        \setlength{\logoheight}{0.125\textheight}
        \setlength{\topheight}{0.2\textheight}
        \setlength{\titleskipabove}{1.5cm}
        \setlength{\titleskipbelow}{1.5cm}
    }
}

\ProcessOptions\relax

%%%%%%%%%%%%
% Commands %
%%%%%%%%%%%%

% Auxiliary commands

\newcommand*{\clearpar}{\unskip\par}

\newcommand*{\countlines}[1]{ % saves the number of lines of #1 in \numlines
    \setbox0\vbox{
        \noindent{#1}\par
        \count@\z@
        \loop
        \unskip\unpenalty\unskip\unpenalty\unskip
        \setbox0\lastbox
        \ifvoid0
           \xdef\numlines{\the\count@}
        \else
           \advance\count@\@ne
        \repeat
    }
}

% Custom fields

\newif\ifLogo
\newif\ifInstitute
\newif\ifObjetivos
\newif\ifInstrumentacion
\newif\ifComponentes
\newif\ifGrado
\newif\ifCurso
\newif\ifDepartment
\newif\ifSubtitle
\newif\ifSupervisor
\newif\ifAsignatura

\newcommand*{\logo}[1]{\gdef\@logo{#1}\Logotrue}
\newcommand*{\objetivos}[1]{\gdef\@objetivos{#1}\Objetivostrue}
\newcommand*{\instrumentacion}[1]{\gdef\@instrumentacion{#1}\Instrumentaciontrue}
\newcommand*{\componentes}[1]{\gdef\@componentes{#1}\Componentestrue}
\newcommand*{\grado}[1]{\gdef\@grado{#1}\Gradotrue}
\newcommand*{\curso}[1]{\gdef\@curso{#1}\Cursotrue}
\newcommand*{\department}[1]{\gdef\@department{#1}\Departmenttrue}
\newcommand*{\subtitle}[1]{\gdef\@subtitle{#1}\Subtitletrue}
\newcommand*{\supervisor}[1]{\gdef\@supervisor{#1}\Supervisortrue}
\newcommand*{\asignatura}[1]{\gdef\@asignatura{#1}\Asignaturatrue}

% Title page

\renewcommand*{\maketitle}{
    \calculateheights
    \newgeometry{margin=2.5cm}
    \begin{titlepage}
        \setlength{\parindent}{0pt}
        \begin{minipage}[t][\topheight]{\textwidth}
            \begin{center}
                \ifLogo
                    \includegraphics[height=\logoheight]{\@logo}
                \fi
                
            \end{center}
        \end{minipage}
        \begin{minipage}{\textwidth}
            \vspace{\titleskipabove}
            \begin{mdframed}[
                linewidth=2pt,
                innertopmargin=3ex,
                innerbottommargin=3ex,
                leftline=false,
                rightline=false
            ]
                \begin{center}
                    {\bfseries\Large\@title\clearpar}
                \end{center}
            \end{mdframed}
            \vspace{-0.25cm}
            \vspace{\titleskipbelow}
        \end{minipage}
        \ifObjetivos
            \begin{center}
             \scshape
              \textbf{\large Objetivos}
            \end{center}
            {\@objetivos\unskip}
        \ifInstrumentacion
            \begin{center}
             \scshape
              \textbf{\large Instrumentaci√≥n}
            \end{center}
            {\@instrumentacion\unskip}
        \ifComponentes
            \begin{center}
             \scshape
              \textbf{\large Componentes}
            \end{center}
            {\@componentes\unskip}

        \begin{center}
            \vfill
                {
                   \scshape
                   \ifGrado
                        {\Large\@grado\unskip\\[1ex]}
                   \fi
                   \clearpar
                }
            \vfill
            \ifDepartment
               {\large\@department\clearpar}
            \fi
            \ifAsignatura
                {\large\@asignatura\clearpar}
            \fi
            \ifCurso
              {\large Curso \@curso\clearpar}
            \fi
        \end{center}
    \end{titlepage}
    \restoregeometry
}

\endinput
